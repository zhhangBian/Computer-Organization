**卞卓航 22373017**

## 第一题

### 1.1

对于流水线处理器，a情况下T=500ps，b情况下T=200ps

对于非流水线处理器，a情况下$T_a=300+400+350+500+100=1650PS$，b情况下$T_b=200+150+120+190+140=800ps$

### 1.2

在流水线处理器中为5倍的时钟周期，a情况下为2500ps，b情况下为1000ps

在非流水线处理中为时钟周期，a情况下为1650ps，b情况下为800ps

### 1.3

a情况下划分MEM，周期变为400ps

b情况下划分IF，周期变为190ps

### 1.4

a情况下为15%+10%=20%

b情况下为30%+15%=45%

### 1.5

a情况下为50%+15%=65%

b情况下为30%+30%=60%

## 第二题

### 2.1

a型存在写后读、读后写、写后写三种相关

b型存在读后写、写后写、写后读三种相关

### 2.2

a型存在数据冒险，修改为：

```mipsasm
lw $1,40($6)
add $6,$2,$2
nop
nop
sw $6,50($1)
```

b型存在数据冒险，修改为：

```mipsasm
lw $5,-16($5)
nop
nop
sw $5,-15($5)
add $5,$5,$5
```

### 2.3

加入转发后，a型不存在冒险

b型存在数据冒险，需要阻塞一个周期，修改为：

```mipsasm
lw $5,-16($5)
nop
sw $5,-15($5)
add $5,$5,$5
```

### 2.4

|      | 无转发       | 有转发       |
| ---- | ------------ | ------------ |
| a型  | 300*9=2700ps | 400*7=2800ps |
| b型  | 200*9=1800ps | 250*8=2000ps |

a型加速比为2700/2800=0.96

b型加速比为1800/2000=0.90

### 2.5

如果没有M级到E级的转发，即没有GRF和内部转发，那么需要增加阻塞

a型改变为：

```mipsasm
lw $1,40($6)
add $6,$2,$2
nop
sw $6,50($1)
```

b型改变为：

```mipsasm
lw $5,-16($5)
nop
nop
sw $5,-15($5)
add $5,$5,$5
```

### 2.6

|      | 无转发       | 有转发       |
| ---- | ------------ | ------------ |
| a型  | 300*9=2700ps | 360*8=2880ps |
| b型  | 200*9=1800ps | 220*9=1980ps |

a型加速比为2700/2880=0.94

b型加速比为1800/1980=0.91

## 第三题

### 3.1

a指令：

1. 修改数据通路，增加跳转判断单元`BranchUnit`，若跳转则将电路中的的`if_branch`信号置高电平，并将PCnext设置为ALU计算后的地址
2. 其他不需要修改，增加对应的控制信号判断即可

b指令：

1. 对于ALU的输入端口，将其中一个增加选择`rt`和0的MUX对于存储器的地址输入端，增加一个MUX，其输入源分别是原先的`grf[rt]+offest`和增加的`rs+rt`，并增加相应的选择控制信号
2. 给寄存器堆GRF增加新的读出端口和写入端口，并给存储器的数据输入端增加新的选择MUX

### 3.2

a指令：为FU的PCnext设置选择信号，用于判断是否跳转

b指令：增加MUX的选择信号

### 3.3

a型会。`bezi`指令会引入一个新的控制冒险，知道M级才可以判断是否需要跳转，在此之前之后的指令都需要阻塞，会加重原有的阻塞。

b. 不会。`swi`指令不会改变寄存器中存储的值，不会引发冒险，因而不会加重原有的阻塞。

## 第四题

### 4.1

a型为：

```mipsasm
lw $1,40($6)
nop
nop
add $2,$3,$1
add $1,$6,$4
nop
sw $2,20($4)
and $1,$1,$4
```

b型为：

```mipsasm
add $1,$5,$3
nop
nop
sw $1,0($2)
lw $1,4($2)
nop
nop
add $5,$5,$1
sw $1,0($2)
```

### 4.2

a型为：

```mipsasm
lw $1,40($6)
nop
nop
add $2,$3,$1
add $1,$6,$4
and $1,$1,$4
sw $2,20($4)
```

b型为：

```mipsasm
add $7,$5,$3
lw $1,4($2)
nop
sw $7,0($2)
add $5,$5,$1
sw $1,0($2)
```

### 4.3

则在代码执行过程中不会出现阻塞，会出现数据冲突的现象，指令进行计算过程中寄存器中的数可能还未更新，出现错误。

对于a型：两条`sw`指令存入存储器的数都是错误的

对于b型：`sw`存入存储器的数是错的，第二条`add`指令执行时1号寄存器的值还未更新，运算后5号寄存器中的值是错误的

### 4.4

需要输入各级正在的执行的指令。

冒险检测单元通过检测各级指令数据产生的$T_{new}$和以D级为标准的$T_{use}$，判断是否需要阻塞。

并且，判断是否需要阻塞还需要数据的产生寄存器和目的寄存器编号相同，这个判断由解析指令完成。

不需要新的输出信号。







































