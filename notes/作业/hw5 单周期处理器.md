**卞卓航 22373017**

## 一

### 1.1

产生的控制信号表为：

| 控制信号 | `regSrc`            | `regDst`    | `regWrite` | `aluSrc`        | `aluControl` | `memWrite` | `branch`     |
| -------- | ------------------- | ----------- | ---------- | --------------- | ------------ | ---------- | ------------ |
| 含义     | GRF写入端口数据来源 | GRF写入地址 | GRF写使能  | ALU数据输入来源 | ALU控制信号  | DM写使能   | 是否进行跳转 |
| `add`    | 0                   | 1           | 1          | 0               | add          | 0          | 0            |
| `lw`     | 1                   | 0           | 1          | 0               | add          | 0          | 0            |

### 1.2

1. 对于`add`指令，要用到除了DM、分支加法器以外以外的所有单元
2. 对于`lw`指令，需要用到除分支加法器以外的所有单元

### 1.3

1. 对于`add`指令：
   - 分支加法器有输出但没有用到；
   - DM没有输出
2. 对于`lw`指令：
   - 分支加法器有输出但没有用到
   - GRF的第二个输出端口（对应的输入地址为`rt`字段）没有用到

### 1.4

`and`的关键路径是：PC-IFU-GRF-MUX-ALU-MUX-GRF

### 1.5

`lw`的关键路径是：PC-IFU-GRF-MUX-ALU-MUX-DM-MUX-GRF

### 1.6

`beq`的关键路径是：PC-IFU-GRF-MUX-ALU-BRANCH-MUX-PC

## 二

1. 对于上述指令，PC、IFU、DM、Branch、MUX部件还可以被使用

2. 需要增加：

   1. 三输出寄存器堆GRF
   2. 带有移位输入端口、且支持三数据运算功能的ALU（或改造数据通路使得移位数据从ALU的另一个数据输入端口输入）

3. 增加的控制信号有：

   1. GRF是进行三读出还是二读出
   2. ALU是进行三数据运算还是两数据
   3. ALU的移位控制指令

4. 时钟周期分别为：

   1. 改进前$T=400+200+30+120+350+200+30=1330ps$

      改进后$T'=400+200+30+120+350+200+30=1330ps$

   2. 改进前$T=400+200+30+120+350+200+30=1330ps$

      改进后$T'=400+300+30+120+350+300+30=1530ps$

5. 加速比分别为：

   1. 加速比$S_p=\frac{T}{T'}=\frac{1330}{1330}=1$
   2. 加速比$S_p=\frac{T}{T'}=\frac{1330}{1530}=0.9115$

6. 性能：

   1. a种改变性能没有提升，反而价格上涨，没有意义
   2. b种改变性能变差，价格上升，非常没有意义

## 三

1. 时钟周期
   1. $T_1=400ps$
   2. $T_2=500ps$
2. 对于无条件相对跳转指令，其经过是数据通路为：PC-IFU-SignExtend-Shift2-ADD-MUX，故时钟周期为：
   1. $T_1=400+20+2+120+30=642ps$
   2. $T_2=500+90+20+180+100=890ps$
3. 对于有条件相对跳转指令，其经过是数据通路为：PC-IFU-GRF-MUX-ALU-MUX，故时钟周期为：
   1. $T_1=400+200+30+120+30=780ps$
   2. $T_2=500+220+100+180+100=1100ps$
4. 对于所有指令都需要a，对于需要向存储器进行存取的指令需要b
5. a的时间和其他元件比起来较短，一般不会位于关键路径上。需要对存储器进行存取的指令，b在其关键路径上
6. a不影响时钟周期的长度。b变化影响beq指令和add指令

## 四

1. 数据通路为：IFU-GRF-MUX-ALU-MUX-GRF，故时钟周期为：
   1. $T_1=400+200+30+120+30+200=980ps$
   2. $T_2=500+220+100+180+100+220=1320ps$
2. 数据通路为：IFU-GRF-MUX-ALU-DM-MUX-GRF，故时钟周期为：
   1. $T_1=400+200+30+120+350+30+200=1330ps$
   2. $T_2=500+220+100+180+1000+100+220=2320ps$
3. 时钟周期和`lw`指令的时钟周期一致，故分别为1330ps和2320ps
4. a平均占了0.35的时钟周期，b平均占了0.5的时钟周期
5. a平均占了0.65的时钟周期，b平均占了0.7的时钟周期
6. 对于a和b：
   1. 改变指令寄存器的延迟，加速比为：$S_p=\frac{1330}{1290}=1.031$
   2. 改变数据存储器的延迟，加速比为：$S_p=\frac{2320}{2220}=1.045$

## 五

### 5.1

对于a种问题，可以使用I型指令进行尝试，如使用`addi $1,$0,0x00ff`，如果有a种问题被固定为了0，那么1号寄存器中存储的值就是0x00bf，正确应该为0x00ff

对于b种问题，可以使用`lw`进行尝试，如`lw $1,4($0)`，如果1号寄存器种存储的是dm种对应地址存储的值，则没有固定为0的问题；如果1号寄存器种存储的值为4，则有固定为0的问题

### 5.2

问题a可以检查出来，问题b不可以。

对于问题a，可以用`addi`、`lw`等指令进行实现，检查运算后的结果，如使用`addi $1,$0,0x00bf`，如果有a种问题被固定为了1，那么1号寄存器中存储的值就是0x00ff，正确应该为0x00bf

对于问题2，因为`memToReg`信号只有`lw`、`lh`、`lb`等读存储器指令才会置为1，在`memToReg`置0时，`memRead`也会置为0，从存储器种读出的数据是不确定的，因而不能正确检测

### 5.3

a问题可以通过修改进行实现，但是比较麻烦，通过操作避免有第7位指令为0的指令，如`addi $1,$0,0x40`指令替换为`addi $1,$0,0x20`和`addi $1,$1,0x20`的两步操作

b问题不能回避，使得`lw`等读存储器指令不能正常进行，而且，读存储器的指令不能被替代，因为读存储器都需要将`memToReg`信号置为0

### 5.4

a问题无法检测，事实上在`memRead`信号在被置0时其他的数据通路也不会选择从存储器种读出的数据，置为1时不影响，故无法检测

b问题无法检测，31-26为全为0是R型指令，但是会将`memRead`置1的访问存储器的指令`lw`、`lh`、`lb`都不是R型指令，对是否读出存储器都不影响

### 5.5

a问题可以检测，用一条不跳转的I型指令即可，如`addi $1,$0,$0`，则若指令执行后为0x0000_0004则有该问题

b问题可以检测，使用R型的跳转指令即可，如`jalr`，若不跳转则有该问题，若正常跳转则无该问题

### 5.6

共有 5 个控制信号： `regDst`、`jump` 、`branch`、`memToReg`和`aluSrc`

对于`regDst`：

1. a问题可以使用`lw`指令测试，如`lw $1,0x1000($0)`，如果存入了2号寄存器而不是1号寄存器则有问题
2. b问题可以用add指令测试，如`add $1,$2,$3`，实现给2号寄存器和3号寄存器存入特定的值，如果结果存入了2号寄存器则有问题，如果存入1号寄存器则没有问题

对于`jump`：同第5小题

对于`branch`：

1. a问题可以使用`beq`指令进行检测，实现忘1号寄存器存入非0值，再使用`beq $1,$0,tar`，若跳转则说明有问题
2. b问题无法检测，R型指令的`branch`都为0，无法检测

对于`memToReg`：

1. a问题无法检测，理由同第2小题
2. b问题无法检测，R型指令`memToReg`都为0

对于`aluSrc`：

1. a问题可以使用add指令进行检测，如`add $1,$0,$0`，若1号寄存器存储的结果为0x0820则有问题，若为0则无a问题
2. b问题无法检测，R型指令的`aluSrc`都为0

## 六

### 6.1

关键路径为：IFU-GRF-MUX-ALU-MUX-DM-MUX-GRF，时间为IFU取出指令到DM接受的时间差

1. 对于a，$t_1=1330-400-350=580ps$
2. 对于b，$t_2=2320-500-1000=820ps$

### 6.2

`jump`信号最不关键

1. 对于a，$t_1=1330-400-30=900ps$
2. 对于b，$t_2=2320-500-100=1720ps$

### 6.3

`aluSrc`信号最关键，需要在shift移位单元产生结果前生成控制信号

1. 对于a，$t_1=20ps$
2. 对于b，$t_2=90ps$

### 6.4

时钟周期：a为1330ps，b为2320ps

### 6.5

会加速`regDst,memRead,aluOp,memWrite,regWrite`指令

| 编号 | `regDst` | `memRead` | `aluOp` | `memWrite` | `regWrite` | 代价       |
| ---- | -------- | --------- | ------- | ---------- | ---------- | ---------- |
| a    | +20      | +50       | +20     | +130       | +70        | 290/5=58   |
| b    | +100     | +135      | +680    | +180       | +100       | 1195/5=239 |

### 6.6

会减慢`jump,branch,memToreg`指令
